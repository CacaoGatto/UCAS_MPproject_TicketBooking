# 实验报告



### 一、实验概述

#### 1、实验背景

本实验设计并实现了一个用于列车售票场景的并发系统。通过编写 `buyTicket` 和 `refundTicket` 方法，实现了可线性化的并发售票、退票过程；通过编写 `inquery` 方法，实现了并发无锁的余票查询功能。并且，在现有功能的基础上，还增加了一些优化设计的尝试，并在理论上分析了各种优化思想的适用场景。最后，性能评估显示，基础的实验设计在要求场景下已有较好的性能，而加入各种优化模块后的性能表现也基本论证了对各自最佳适用场景的分析。

#### 2、应用场景

基于实验要求和评分环境的设置，本项目适用场景的限制如下所示。相关参数理论上都可以直接扩展，在后续的“数据结构设计”部分也会介绍目前的设计考虑和扩展方式。

- 出票数至多为线程数的 12 万倍
- 列车车次数的上限为 64
- 每辆列车的总座位数（车厢数乘每车厢座位数）的上限为 16384
- 车站总数的上限为 32

### 二、数据结构设计

#### 1、座位为单位的余票结构



#### 2、全局出票记录



### 三、可线性化分析



### 四、优化设计

#### 1、余票结构的缓存行对齐



#### 2、TID 的线程级减负



#### 3、余票售空时的缓存记录



### 五、性能评测



### 六、实验总结